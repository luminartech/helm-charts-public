---
## @section Global parameters
## Global parameters
## These variables are accessible to all dependency helm charts.
##

global:
  ## @param global.chartNameOverride Overrides the chart name.
  ##
  chartNameOverride: ""
  ## @param global.releaseNameOverride Overrides the release name.
  ##
  releaseNameOverride: ""
  ## @param global.tags Define common tags for all IAC and app resources generated by this chart.
  ##
  tags: {}
  ## @param global.labels Define common labels for all IAC and app resources generated by this chart.
  ##
  labels: {}
  ## @param global.annotations Define common annotations for all IAC and app resources generated by this chart.
  ##
  annotations: {}
  ## @param global.providerConfigRef.name Default crossplane provider all resources generated for crossplane.
  ##
  providerConfigRef:
    name: aws-provider
  ## @param global.awsAccountId Default aws account id for crossplane aws provider resources. Quotes are important, value must be a string.
  ##
  awsAccountId: "0123456789"
  ## @param global.awsRegion Default aws region for crossplane aws provider resources.
  ##
  awsRegion: us-west-2
  ## @param global.eksHash Default EKS cluster hash for relevant crossplane resources such as IAM Role.
  ##
  eksHash: "XXXXX"
  ## @param global.deploymentName Deployment name used as fullnameoverride for upstream chart.
  ##
  deploymentName: aws-mountpoint-s3-csi-driver

## @section Dependency: aws-mountpoint-s3-csi-driver upstream helm chart parameters.
## ref: https://github.com/awslabs/mountpoint-s3-csi-driver/blob/helm-chart-aws-mountpoint-s3-csi-driver-1.7.0/charts/aws-mountpoint-s3-csi-driver/values.yaml
##

aws-mountpoint-s3-csi-driver:
  ## @param aws-mountpoint-s3-csi-driver.enabled Toggle for enabling or disabling upstream chart templates.
  ##
  enabled: false

  ## @param aws-mountpoint-s3-csi-driver.node.tolerateAllTaints Daemonset Tolerate all taints.
  ##
  node:
    serviceAccount:
      annotations:
        "eks.amazonaws.com/role-arn": 'arn:aws:iam::{{ .Values.global.awsAccountId }}:role/{{ include "common-gitops.names.release" . }}'
    tolerateAllTaints: true

## @section Dependency: crossplane-aws-iam upstream helm chart parameters
## ref: https://github.com/luminartech/helm-charts-public/blob/main/charts/iac/crossplane-aws-iam/values.yaml
## AWS resources parameters.
## items: Dict of one or more resources of its kind.
## items._: Name of the resource in the kubernetes. "_" generates a default name as releaseName-object name
## ref: https://github.com/luminartech/helm-charts-public/blob/478ec718b93063f1eccfa591189ab0f59bf3fd1e/charts/shared/common-gitops/templates/_names.tpl#L50
##
crossplane-aws-iam:
  ## @skip crossplane-aws-iam.enabled
  enabled: false

  ## @skip crossplane-aws-iam.Policy
  Policy:
    items:
      _:
        forProvider:
          description: "IAM Policy for S3 bucket access"
          policy:
            Statement:
              mountpointFullBucketAccess:
                Effect: "Allow"
                Action: "s3:ListBucket"
                Resource: "arn:aws:s3:::DOC-EXAMPLE-BUCKET1"
              # TODO: Grant access in the bucket policy also
              mountpointFullObjectAccess:
                Effect: Allow
                Action:
                  - s3:GetObject
                  - s3:PutObject
                  - s3:AbortMultipartUpload
                Resource:
                  - arn:aws:s3:::DOC-EXAMPLE-BUCKET1/*

  ## @skip crossplane-aws-iam.Role
  Role:
    items:
      _:
        forProvider:
          description: "IAM Role for S3 bucket access"
          assumeRolePolicy:
            Statement:
              assumeWebIdS3Csi:
                Effect: "Allow"
                Action: "sts:AssumeRoleWithWebIdentity"
                Principal:
                  Federated: "arn:aws:iam::{{ .Values.global.awsAccountId }}:oidc-provider/oidc.eks.{{ .Values.global.awsRegion }}.amazonaws.com/id/{{ .Values.global.eksHash }}"
                Condition:
                  StringLike:
                    "oidc.eks.{{ .Values.global.awsRegion }}.amazonaws.com/id/{{ .Values.global.eksHash }}:sub": "system:serviceaccount:kube-system:s3-csi-*"
                    "oidc.eks.{{ .Values.global.awsRegion }}.amazonaws.com/id/{{ .Values.global.eksHash }}:aud": "sts.amazonaws.com"

  ## @skip crossplane-aws-iam.RolePolicyAttachment
  RolePolicyAttachment:
    items:
      _:
        forProvider:
          policyArnRef:
            name: '{{ include "common-gitops.names.release" . }}'
          roleRef:
            name: '{{ include "common-gitops.names.release" . }}'
