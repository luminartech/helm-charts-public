---
## @section Global parameters
## Global parameters
## These variables are accessible to all dependency helm charts.
##

global:
  ## @param global.chartNameOverride Overrides the chart name.
  ##
  chartNameOverride: ""
  ## @param global.releaseNameOverride Overrides the release name.
  ##
  releaseNameOverride: ""
  ## @param global.tags Define common tags for all IAC and app resources generated by this chart.
  ##
  tags: {}
  ## @param global.labels Define common labels for all IAC and app resources generated by this chart.
  ##
  labels: {}
  ## @param global.annotations Define common annotations for all IAC and app resources generated by this chart.
  ##
  annotations: {}
  ## @param global.providerConfigRef.name Default crossplane provider all resources generated for crossplane.
  ##
  providerConfigRef:
    name: aws-0123456789
  ## @param global.awsAccountId Default aws account id for crossplane aws provider resources. Quotes are important, value must be a string.
  ##
  awsAccountId: "0123456789"
  ## @param global.awsRegion Default aws region for crossplane aws provider resources.
  ##
  awsRegion: us-west-2
  ## @param global.zoneName Default allowed record names.
  ##
  zoneName: "example.com."
  ## @param global.clientAwsAccountId Id of the AWS Account that is trying to obtain access to shared DNS zone.
  ##
  clientAwsAccountId: "9876543210"
  ## @param global.clientExternalDnsRoleName Role name used by client's external-dns to access shared DNS zone.
  ##
  clientExternalDnsRoleName: "tenant-role"
  ## @param global.clientCertManagerRoleName Role name used by client's cert-manager to access shared DNS zone.
  ##
  clientCertManagerRoleName: "tenant-role"

## @section AWS IAM configurations
##
## @skip crossplane-aws-iam
crossplane-aws-iam:
  enabled: false
  Policy:
    items:
      _:
        forProvider:
          description: "IAM Policy to access r53 hostedzones"
          policy:
            Statement:
              allowR53getChange:
                Effect: Allow
                Action: route53:GetChange
                Resource: arn:aws:route53:::change/*
              allowRecordSets:
                Effect: Allow
                Action: "route53:ChangeResourceRecordSets"
                Resource: "arn:aws:route53:::hostedzone/*"
                Condition:
                  "ForAllValues:StringLike":
                    "route53:ChangeResourceRecordSetsNormalizedRecordNames":
                      - '*.{{ .Values.global.zoneName }}'
              allowR53ListHostedZones:
                Effect: Allow
                Action:
                  - "route53:ListHostedZones"
                  - "route53:ListHostedZonesByName"
                  - "route53:ListResourceRecordSets"
                Resource: '*'
  Role:
    items:
      _:
        forProvider:
          assumeRolePolicy:
            Statement:
              allowAssume:
                Effect: Allow
                Principal:
                  AWS:
                    - "arn:aws:iam::{{ .Values.global.clientAwsAccountId }}:role/{{ .Values.global.clientExternalDnsRoleName }}"
                    - "arn:aws:iam::{{ .Values.global.clientAwsAccountId }}:role/{{ .Values.global.clientCertManagerRoleName }}"
                Action: sts:AssumeRole
  RolePolicyAttachment:
    items:
      _:
        forProvider:
          policyArnRef:
            name: '{{ include "common-gitops.names.release" . }}'
          roleRef:
            name: '{{ include "common-gitops.names.release" . }}'
