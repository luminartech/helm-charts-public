---
## @section Global parameters
## Global parameters
## These variables are accessible to all dependency helm charts.
##

global:
  ## @param global.chartNameOverride Overrides the chart name.
  ##
  chartNameOverride: ""
  ## @param global.releaseNameOverride Overrides the release name.
  ##
  releaseNameOverride: ""
  ## @param global.tags Define common tags for all IAC and app resources generated by this chart.
  ##
  tags: {}
  ## @param global.labels Define common labels for all IAC and app resources generated by this chart.
  ##
  labels: {}
  ## @param global.annotations Define common annotations for all IAC and app resources generated by this chart.
  ##
  annotations: {}
  ## @param global.providerConfigRef.name Default crossplane provider all resources generated for crossplane.
  ##
  providerConfigRef:
    name: aws-provider
  ## @param global.awsAccountId Default aws account id for crossplane aws provider resources. Quotes are important, value must be a string.
  ##
  awsAccountId: "0123456789"
  ## @param global.awsRegion Default aws region for crossplane aws provider resources.
  ##
  awsRegion: us-west-2
  ## @param global.eksHash Default EKS cluster hash for relevant crossplane resources such as IAM Role.
  ##
  eksHash: "XXXXX"
  ## @param global.secretStoreNamespace (Deprecated) Deploy external-secret store configs to different namespace than helm chart target namespace.
  ##
  secretStoreNamespace: infra-argo-cd
  ## @param global.deploymentName Deployment name used as fullnameoverride for upstream chart.
  ##
  deploymentName: external-secrets

## @section Dependency: external-secrets upstream helm chart parameters.
## ref: https://github.com/external-secrets/external-secrets/blob/v0.7.0/deploy/charts/external-secrets/values.yaml
##

external-secrets:
  ## @param external-secrets.enabled Toggle for enabling or disabling upstream chart templates.
  ##
  enabled: false

  ## @param external-secrets.replicaCount Default minimum replicas for app.
  ##
  replicaCount: 2

  ## @param external-secrets.fullnameOverride Default full name override for upstream chart. This is needed to stop upstream chart from hitting the 63 char limit for object names
  ##
  fullnameOverride: external-secrets

  ## @param external-secrets.installCRDs Install CRDs with helm chart.
  ##
  installCRDs: true

  ## Metrics service configuration
  ## @param external-secrets.metrics.service.enabled Toggle for metrics service.
  ## When metrics is enabled, it conflicts with serviceMonitor.
  ## Keep metrics service disabled if serviceMonitor is enabled
  ##
  metrics:
    service:
      enabled: false

  ## serviceMonitor service configuration
  ## @param external-secrets.serviceMonitor.enabled Toggle for serviceMonitor service.
  ## @param external-secrets.serviceMonitor.additionalLabels.release Monitoring service label filter.
  ##
  serviceMonitor:
    enabled: false
    additionalLabels:
      release: monitoring

  ## Webhook service configurations
  ## @param external-secrets.webhook.metrics.service.enabled Toggle for webhook metrics service.
  ## When metrics is enabled, it conflicts with serviceMonitor.
  ## Keep metrics service disabled if serviceMonitor is enabled
  ## @param external-secrets.webhook.serviceMonitor.enabled Toggle for webhook serviceMonitor service.
  ## @param external-secrets.webhook.serviceMonitor.additionalLabels.release Monitoring service label filter.
  ##
  webhook:
    metrics:
      service:
        enabled: true
    serviceMonitor:
      enabled: false
      additionalLabels:
        release: monitoring

  ## certController service configurations
  ## @param external-secrets.certController.metrics.service.enabled Toggle for certController metrics service.
  ## When metrics is enabled, it conflicts with serviceMonitor.
  ## Keep metrics service disabled if serviceMonitor is enabled
  ## @param external-secrets.certController.serviceMonitor.enabled Toggle for certController serviceMonitor service.
  ## @param external-secrets.certController.serviceMonitor.additionalLabels.release Monitoring service label filter.
  ##
  certController:
    metrics:
      service:
        enabled: false
    serviceMonitor:
      enabled: false
      additionalLabels:
        release: monitoring

## @section Dependency: crossplane aws iam resources parameters
## ref: https://github.com/luminartech/helm-charts-public/blob/main/charts/iac/crossplane-aws-iam/values.yaml
crossplane-aws-iam:
  ## @param crossplane-aws-iam.enabled Toggle for enabling or disabling upstream chart templates.
  ##
  enabled: false
  ## @param crossplane-aws-iam.deletionPolicy Crossplane will delete or orphan resource when helm chart is uninstalled. Allowed values: `Delete` or `Orphan`.
  ##
  deletionPolicy: Delete
  ## AWS IAM Policy resources parameters.
  ## items: Dict of one or more Policy resources.
  ## ref: https://github.com/luminartech/helm-charts-public/blob/main/charts/iac/crossplane-aws-iam/templates/policy.yaml
  ## items._: Name of the resource in the kubernetes. "_" generates a default name as releaseName-object name
  ## ref: https://github.com/luminartech/helm-charts-public/blob/478ec718b93063f1eccfa591189ab0f59bf3fd1e/charts/shared/common-gitops/templates/_names.tpl#L50
  ##
  Policy:
    items:
      _:
        ## @param crossplane-aws-iam.Policy.items._.deletionPolicy Overrides crossplane-aws-iam.deletionPolicy value.
        ##
        deletionPolicy: Delete
        ## Resource specific additional annotations.
        ## @param crossplane-aws-iam.Policy.items._.annotations.crossplane.io/external-name AWS resource name to import if exists.
        ##
        annotations:
          crossplane.io/external-name: 'arn:aws:iam::{{ .Values.global.awsAccountId }}:policy/{{ include "common-gitops.names.release" . }}'
        ## AWS Configuration for Policy resources.
        ## @param crossplane-aws-iam.Policy.items._.forProvider.description AWS resource description.
        ## @skip crossplane-aws-iam.Policy.items._.forProvider.document
        ##
        forProvider:
          description: "IAM Policy for external secrets IAM role to access aws secret manager resources"
          document:
            Statement:
              secretsManagerRead:
                Effect: "Allow"
                Action:
                  - "secretsmanager:ListSecrets"
                  - "secretsmanager:GetResourcePolicy"
                  - "secretsmanager:GetSecretValue"
                  - "secretsmanager:DescribeSecret"
                  - "secretsmanager:ListSecretVersionIds"
                Resource: "arn:aws:secretsmanager:{{ .Values.global.awsRegion }}:{{ .Values.global.awsAccountId }}:secret:*"

  ## AWS IAM Role resources parameters.
  ## items: Dict of one or more Role resources.
  ## ref: https://github.com/luminartech/helm-charts-public/blob/main/charts/iac/crossplane-aws-iam/templates/role.yaml
  ## items._: Name of the resource in the kubernetes. "_" generates a default name as releaseName-object name
  ## ref: https://github.com/luminartech/helm-charts-public/blob/478ec718b93063f1eccfa591189ab0f59bf3fd1e/charts/shared/common-gitops/templates/_names.tpl#L50
  ##
  Role:
    items:
      _:
        ## @param crossplane-aws-iam.Role.items._.deletionPolicy Overrides crossplane-aws-iam.deletionPolicy value.
        ##
        deletionPolicy: Delete
        ## Resource specific additional annotations.
        ## @param crossplane-aws-iam.Role.items._.annotations.crossplane.io/external-name AWS resource name to import if exists.
        ##
        annotations:
          crossplane.io/external-name: '{{ include "common-gitops.names.release" . }}'
        ## AWS Configuration for Role resources.
        ## @skip crossplane-aws-iam.Role.items._.forProvider.assumeRolePolicyDocument
        ## Default policy grants assume role permission to the service pod running in given eks cluster, namespace and service account.
        ##
        forProvider:
          assumeRolePolicyDocument:
            Statement:
              assumeRoleWithWebIdentitiy:
                Effect: "Allow"
                Action: "sts:AssumeRoleWithWebIdentity"
                Principal:
                  Federated: 'arn:aws:iam::{{ .Values.global.awsAccountId }}:oidc-provider/oidc.eks.{{ .Values.global.awsRegion }}.amazonaws.com/id/{{ .Values.global.eksHash }}'
                Condition:
                  StringEquals:
                    'oidc.eks.{{ .Values.global.awsRegion }}.amazonaws.com/id/{{ .Values.global.eksHash }}:sub': 'system:serviceaccount:{{ .Release.Namespace }}:{{ .Values.global.deploymentName }}'
                    'oidc.eks.{{ .Values.global.awsRegion }}.amazonaws.com/id/{{ .Values.global.eksHash }}:aud': 'sts.amazonaws.com'
              assumeRole:
                Effect: "Allow"
                Principal:
                  Service: "ec2.amazonaws.com"
                Action: "sts:AssumeRole"
              selfAssume:
                Effect: "Allow"
                Principal:
                  AWS: "*"
                Action: "sts:AssumeRole"
                Condition:
                  ArnLike:
                    "aws:PrincipalArn": 'arn:aws:iam::{{ .Values.global.awsAccountId }}:role/{{ include "common-gitops.names.release" . }}'

  ## AWS IAM RolePolicyAttachment resources parameters.
  ## items: Dict of one or more RolePolicyAttachment resources.
  ## ref: https://github.com/luminartech/helm-charts-public/blob/main/charts/iac/crossplane-aws-iam/templates/rolepolicyattachment.yaml
  ## items._: Name of the resource in the kubernetes. "_" generates a default name as releaseName-object name
  ## ref: https://github.com/luminartech/helm-charts-public/blob/478ec718b93063f1eccfa591189ab0f59bf3fd1e/charts/shared/common-gitops/templates/_names.tpl#L50
  ##
  RolePolicyAttachment:
    items:
      _:
        ## @param crossplane-aws-iam.RolePolicyAttachment.items._.deletionPolicy Overrides crossplane-aws-iam.deletionPolicy value.
        ##
        deletionPolicy: Delete
        ## Resource specific additional annotations.
        ## @param crossplane-aws-iam.RolePolicyAttachment.items._.annotations.crossplane.io/external-name AWS resource name to import if exists.
        ##
        annotations:
          crossplane.io/external-name: '{{ include "common-gitops.names.release" . }}'
        ## AWS Configuration for RolePolicyAttachment resources.
        ## @param crossplane-aws-iam.RolePolicyAttachment.items._.forProvider.policyArnRef.name Reference to the Policy resource created by this helm chart.
        ## @param crossplane-aws-iam.RolePolicyAttachment.items._.forProvider.roleNameRef.name Reference to the Role resource created by this helm chart.
        ##
        forProvider:
          policyArnRef:
            name: '{{ include "common-gitops.names.release" . }}'
          roleNameRef:
            name: '{{ include "common-gitops.names.release" . }}'

## @section Addons: Addon template parameters
##

## External secret resource for AWS secrets Manager secrets.
## ref to values-test.yaml for examples
AWSExternalSecret:
  ## @param AWSExternalSecret.enabled Toggle for enabling or disabling resource type.
  ##
  enabled: false

VclusterExternalSecret:
  ## @param VclusterExternalSecret.enabled Toggle for enabling or disabling resource type.
  ##
  enabled: false

EksClusterExternalSecret:
  ## @param EksClusterExternalSecret.enabled Toggle for enabling or disabling resource type.
  ##
  enabled: false

ExternalSecretRole:
  ## @param ExternalSecretRole.enabled Toggle for enabling or disabling resource type.
  ##
  enabled: false

ExternalSecretRoleBinding:
  ## @param ExternalSecretRoleBinding.enabled Toggle for enabling or disabling resource type.
  ##
  enabled: false

ClusterSecretStore:
  ## @param ClusterSecretStore.enabled Toggle for enabling or disabling resource type.
  ##
  enabled: false

SecretStore:
  ## @param SecretStore.enabled Toggle for enabling or disabling resource type.
  ##
  enabled: false

ExternalSecretsServiceAccount:
  ## @param ExternalSecretsServiceAccount.enabled Toggle for enabling or disabling resource type.
  ##
  enabled: false
