---
## @section Global parameters
## Global parameters
## These variables are accessible to all dependency helm charts.
##

global:
  ## @param global.chartNameOverride Overrides the chart name.
  ##
  chartNameOverride: ""
  ## @param global.releaseNameOverride Overrides the release name.
  ##
  releaseNameOverride: ""
  ## @param global.tags Define common tags for all IAC and app resources generated by this chart.
  ##
  tags: {}
  ## @param global.labels Define common labels for all IAC and app resources generated by this chart.
  ##
  labels: {}
  ## @param global.annotations Define common annotations for all IAC and app resources generated by this chart.
  ##
  annotations: {}
  ## @param global.awsAccountId Default aws account id for crossplane aws provider resources. Quotes are important, value must be a string.
  ##
  awsAccountId: "0123456789"
  ## @param global.awsRegion Default aws region for crossplane aws provider resources.
  ##
  awsRegion: us-east-2
  ## @param global.eksHash Default EKS cluster hash for relevant crossplane resources such as IAM Role.
  ##
  eksHash: "XXXXX"
  ## @param global.providerConfigRef.name Default crossplane provider all resources generated for crossplane.
  ##
  providerConfigRef:
    name: crossplane-provider-config-aws
  ## @param global.logLevel Set log level to 2 for normal mode and 6 for debug mode.
  logLevel: 6
  ## @param global.deploymentName Deployment name for the app.
  deploymentName: argo-workflows
  ## @skip global.securityContext
  ##
  securityContext:
    runAsUser: 999
    runAsGroup: 999
    fsGroup: 999
  ## @skip global.logging
  ##
  logging:
    format: json
    level: debug

## @skip argo-workflows
argo-workflows:
  enabled: false
  fullnameOverride: argo-workflows
  createAggregateRoles: true
  crds:
    install: true
    keep: true
  server:
    extraArgs:
    - --auth-mode=server
  controller:
    replicas: 2
    metricsConfig:
      enabled: false
    telemetryConfig:
      enabled: false
    serviceMonitor:
      enabled: false
    workflowNamespaces:
      - "infra-aws-eks-argo-workflows"

## @skip crossplane-aws-iam
crossplane-aws-iam:
  enabled: false
  Policy:
    items:
      _:
        forProvider:
          description: "IAM Policy for argo-workflows to access aws services"
          policy:
            Statement:
              denyAll:
                Effect: Deny
                Action: '*'
                Resource: '*'
  Role:
    items:
      _:
        forProvider:
          assumeRolePolicy:
            Statement:
              allowAssumeRoleWebIdentity:
                Effect: Allow
                Action: sts:AssumeRoleWithWebIdentity
                Principal:
                  Federated: arn:aws:iam::{{ .Values.global.awsAccountId }}:oidc-provider/oidc.eks.{{ .Values.global.awsRegion }}.amazonaws.com/id/{{ .Values.global.eksHash }}
                Condition:
                  StringLike:
                    "oidc.eks.{{ .Values.global.awsRegion }}.amazonaws.com/id/{{ .Values.global.eksHash }}:sub": system:serviceaccount:{{ .Release.Namespace }}:{{ .Values.global.deploymentName }}-*
                    "oidc.eks.{{ .Values.global.awsRegion }}.amazonaws.com/id/{{ .Values.global.eksHash }}:aud": sts.amazonaws.com
              allowEC2AssumeRole:
                Effect: Allow
                Principal:
                  Service: ec2.amazonaws.com
                Action: sts:AssumeRole
              allowSelfAssumeRole:
                Effect: Allow
                Principal:
                  AWS: '*'
                Action: sts:AssumeRole
                Condition:
                  ArnLike:
                    'aws:PrincipalArn': arn:aws:iam::{{ .Values.global.awsAccountId }}:role/{{ include "common-gitops.names.release" . }}
  RolePolicyAttachment:
    items:
      _:
        forProvider:
          policyArnRef:
            name: '{{ include "common-gitops.names.release" . }}'
          roleRef:
            name: '{{ include "common-gitops.names.release" . }}'

## @skip Workflow
Workflow: {}

## @skip CronWorkflow
CronWorkflow: {}

## @skip WorkflowTemplate
WorkflowTemplate: {}

## @skip ClusterWorkflowTemplate
ClusterWorkflowTemplate: {}
