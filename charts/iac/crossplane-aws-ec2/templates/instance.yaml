{{- $kind := "Instance" -}}
{{- $root := . -}}
{{- $kindObj := or (get $root.Values $kind) (dict) -}}
{{- range $name, $item := $kindObj.items -}}
  {{- if hasKey $item "enabled" | ternary ($item.enabled) (ne $kindObj.enabled false) }}
---
apiVersion: ec2.aws.crossplane.io/v1alpha1
kind: {{ $kind }}
metadata:
  name: {{ include "common-gitops.names.itemFullname" (dict "root" $root "name" $name "override" .name) }}
    {{- include "common-gitops.labels" (dict "root" $root "name" $name "kind" $kind) | trim | nindent 2 }}
    {{- include "common-gitops.annotations" (dict "root" $root "name" $name "kind" $kind) | trim | nindent 2 }}
spec:
    {{- include "common-gitops.crossplane.awsDeletionPolicy" (dict "root" $root "name" $name "kind" $kind) | nindent 2 }}
  forProvider:
    {{- with .forProvider }}
      {{- with .ElasticGpuSpecification }}
    ElasticGpuSpecification:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
      {{- with .blockDeviceMappings }}
    blockDeviceMappings:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
      {{- with .capacityReservationSpecification }}
    capacityReservationSpecification:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
      {{- with .clientToken }}
    clientToken: {{ . | quote }}
      {{- end }}
      {{- with .cpuOptions }}
    cpuOptions:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
      {{- with .creditSpecification }}
    creditSpecification:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
      {{- with .disableAPITermination }}
    disableAPITermination: {{ . }}
      {{- end }}
      {{- with .ebsOptimized }}
    ebsOptimized: {{ . }}
      {{- end }}
      {{- with .elasticInferenceAccelerators }}
    elasticInferenceAccelerators:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
      {{- with .hibernationOptions }}
    hibernationOptions:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
      {{- with .iamInstanceProfile }}
    iamInstanceProfile:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
      {{- with (.imageId | required "imageId is required") }}
    imageId: {{ . | quote }}
      {{- end }}
      {{- with .instanceInitiatedShutdownBehavior }}
    instanceInitiatedShutdownBehavior: {{ . | quote }}
      {{- end }}
      {{- with .instanceMarketOptions }}
    instanceMarketOptions:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
      {{- with .instanceType }}
    instanceType: {{ . | quote }}
      {{- end }}
      {{- with .ipv6AddressCount }}
    ipv6AddressCount: {{ . }}
      {{- end }}
      {{- with .ipv6Addresses }}
    ipv6Addresses:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
      {{- with .kernelId }}
    kernelId: {{ . | quote }}
      {{- end }}
      {{- with .keyName }}
    keyName: {{ . | quote }}
      {{- end }}
      {{- with .launchTemplate }}
    launchTemplate:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
      {{- with .licenseSpecifications }}
    licenseSpecifications:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
      {{- with .metadataOptions }}
    metadataOptions:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
      {{- with .monitoring }}
    monitoring:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
      {{- with .networkInterfaces }}
    networkInterfaces:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
      {{- with .placement }}
    placement:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
      {{- with .privateIpAddress }}
    privateIpAddress: {{ . | quote }}
      {{- end }}
      {{- with .ramDiskId }}
    ramDiskId: {{ . | quote }}
      {{- end }}
      {{- include "common-gitops.crossplane.reference" (dict "field" "securityGroupIds"
                                            "fieldRef" "securityGroupRefs"
                                            "fieldSelector" "securityGroupSelector"
                                            "context" . "root" $root "optional" true) | nindent 4 }}

      {{- include "common-gitops.crossplane.reference" (dict "field" "subnetId"
                                            "context" . "root" $root "optional" true) | nindent 4 }}
      {{- with .tagSpecifications }}
    tagSpecifications:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
      {{- with .userData }}
    userData:
        {{- include "common-gitops.tplvalues.render" (dict "value" . "context" $root) | nindent 6 }}
      {{- end }}
    {{- end }}
    {{- include "common-gitops.tags.list" (dict "root" $root "name" $name "kind" $kind "nameOverride" .name) | nindent 4 }}
    {{- include "common-gitops.crossplane.awsRegion" (dict "root" $root "name" $name "kind" $kind) | nindent 4 }}
    {{- include "common-gitops.crossplane.publishConnectionDetailsTo" (dict "root" $root "name" $name "kind" $kind "nameOverride" .name) | nindent 2 }}
    {{- include "common-gitops.crossplane.writeConnectionSecretToRef" (dict "root" $root "name" $name "kind" $kind "nameOverride" .name) | nindent 2 }}
    {{- include "common-gitops.crossplane.providerConfigRef" (dict "root" $root "name" $name "kind" $kind) | nindent 2 }}
  {{- end -}}
{{- end -}}
